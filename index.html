<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HACCP RAG Demo</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel (브라우저에서 JSX 변환) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { background:#fff; font-family: sans-serif; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- 여기에 React 코드 -->
    <script type="text/babel">
      const API_BASE = "http://34.133.102.47:8000"; // ← 네 서버 API 주소

      function App() {
        const [query, setQuery] = React.useState("");
        const [results, setResults] = React.useState([]);

        const handleSearch = async (e) => {
          e.preventDefault();
          if (!query.trim()) return;
          try {
            const res = await fetch(`${API_BASE}/search`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ query, top_k: 5 })
            });
            const data = await res.json();
            setResults(data.results || []);
          } catch (err) {
            console.error(err);
            alert("검색 실패");
          }
        };

        return (
          <div className="max-w-3xl mx-auto p-6">
            <h1 className="text-xl font-bold mb-4">HACCP 생성형 AI 통합 정보 제공 서비스</h1>

            <form onSubmit={handleSearch} className="mb-4 flex gap-2">
              <input
                className="flex-1 border rounded px-3 py-2"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                placeholder="질문을 입력하세요"
              />
              <button className="px-4 py-2 bg-blue-600 text-white rounded">검색</button>
            </form>

            <div className="space-y-3">
              {results.length === 0 ? (
                <p className="text-gray-500 text-sm">검색 결과가 여기에 표시됩니다.</p>
              ) : (
                results.map((r, i) => (
                  <div key={i} className="p-3 border rounded">
                    <div className="text-sm text-gray-500 mb-1">{r.source}</div>
                    <div>{r.text || r.enriched_text}</div>
                  </div>
                ))
              )}
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
