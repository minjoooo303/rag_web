<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>RAG 데모</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; color: #111; }
    h2 { margin-top: 28px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .col { flex: 1 1 340px; min-width: 300px; }
    textarea, input { width: 100%; padding: 10px; font-size: 14px; }
    button { padding: 10px 14px; font-size: 14px; border: 0; border-radius: 8px; background:#2563eb; color:#fff; cursor:pointer; }
    button:disabled { background:#9ca3af; cursor:not-allowed; }
    .card { background:#f8fafc; border:1px solid #e5e7eb; border-radius: 10px; padding: 12px; margin-top: 10px; }
    .muted { color:#6b7280; font-size:13px; }
    .err { color:#b91c1c; font-weight:600; }
    .ok  { color:#065f46; font-weight:600; }
    .pill { display:inline-block; background:#eef2ff; border:1px solid #c7d2fe; padding:2px 8px; border-radius:999px; margin-right:6px; margin-bottom:6px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>RAG 데모</h1>

  <div class="card">
    <div class="row">
      <div class="col">
        <label>API Base 주소</label>
        <input id="apiBase" placeholder="예: http://localhost:8000 또는 https://xxx.trycloudflare.com" />
        <div class="muted">브라우저에 저장됩니다. (localStorage)</div>
      </div>
      <div class="col">
        <label>상태</label>
        <div id="health" class="muted">확인 전</div>
      </div>
    </div>
    <div style="margin-top:10px">
      <button onclick="saveApiBase()">주소 저장</button>
      <button onclick="checkHealth()">/health 체크</button>
    </div>
  </div>

  <!-- 이하 내용은 그대로 (init / classify / query UI) -->

  <script>
    const el = (id) => document.getElementById(id);

    // API Base 관리 (localStorage 활용)
    function getApiBase() {
      return (el("apiBase").value || "").replace(/\/+$/,"");
    }
    function saveApiBase() {
      const val = getApiBase();
      localStorage.setItem("apiBase", val);
      alert("API 주소 저장됨: " + val);
    }
    function loadApiBase() {
      const saved = localStorage.getItem("apiBase");
      if (saved) el("apiBase").value = saved;
    }

    async function fetchData(path, payload) {
      const url = `${getApiBase()}${path}`;
      const res = await fetch(url, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload || {})
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    async function checkHealth() {
      try {
        const res = await fetch(`${getApiBase()}/health`);
        const j = await res.json();
        el("health").innerHTML = `<span class="ok">ok</span> — 로드됨: ${(j.loaded_categories||[]).join(", ")}`;
      } catch (e) {
        el("health").innerHTML = `<span class="err">${e}</span>`;
      }
    }

    // 페이지 로드시 API 주소 자동 로드
    loadApiBase();
  </script>
</body>
</html>
